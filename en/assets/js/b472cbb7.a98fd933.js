"use strict";(self.webpackChunkathenaserving=self.webpackChunkathenaserving||[]).push([[182],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>k});var n=t(67294);function l(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){l(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,l=function(e,a){if(null==e)return{};var t,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(l[t]=e[t]);return l}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=n.createContext({}),c=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},d=function(e){var a=c(e.components);return n.createElement(s.Provider,{value:a},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=c(t),m=l,k=u["".concat(s,".").concat(m)]||u[m]||p[m]||r;return t?n.createElement(k,o(o({ref:a},d),{},{components:t})):n.createElement(k,o({ref:a},d))}));function k(e,a){var t=arguments,l=a&&a.mdxType;if("string"==typeof e||l){var r=t.length,o=new Array(r);o[0]=m;var i={};for(var s in a)hasOwnProperty.call(a,s)&&(i[s]=a[s]);i.originalType=e,i[u]="string"==typeof e?e:l,o[1]=i;for(var c=2;c<r;c++)o[c]=t[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},64324:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var n=t(87462),l=(t(67294),t(3905));const r={sidebar_position:7,sidebar_label:"\u5efa\u8868"},o=void 0,i={unversionedId:"\u6570\u636e\u5b58\u50a8/ClickHouse/\u5efa\u8868",id:"\u6570\u636e\u5b58\u50a8/ClickHouse/\u5efa\u8868",title:"\u5efa\u8868",description:"\u5728ClickHouse\u4e2d\u521b\u5efa\u8868",source:"@site/docs/\u6570\u636e\u5b58\u50a8/ClickHouse/\u5efa\u8868.md",sourceDirName:"\u6570\u636e\u5b58\u50a8/ClickHouse",slug:"/\u6570\u636e\u5b58\u50a8/ClickHouse/\u5efa\u8868",permalink:"/en/docs/\u6570\u636e\u5b58\u50a8/ClickHouse/\u5efa\u8868",draft:!1,editUrl:"https://github.com/zhangyongtian/bigdataknowledge/tree/dev/docs/\u6570\u636e\u5b58\u50a8/ClickHouse/\u5efa\u8868.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7,sidebar_label:"\u5efa\u8868"},sidebar:"docSidebar",previous:{title:"\u8868\u5f15\u64ce",permalink:"/en/docs/\u6570\u636e\u5b58\u50a8/ClickHouse/\u8868\u5f15\u64ce"},next:{title:"\u6570\u636e\u7c7b\u578b",permalink:"/en/docs/\u6570\u636e\u5b58\u50a8/ClickHouse/\u6570\u636e\u7c7b\u578b"}},s={},c=[{value:"\u5728ClickHouse\u4e2d\u521b\u5efa\u8868",id:"\u5728clickhouse\u4e2d\u521b\u5efa\u8868",level:2},{value:"\u76f8\u5173\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e",id:"\u76f8\u5173\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e",level:3},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:3},{value:"ClickHouse\u6d88\u8d39Kafka",id:"clickhouse\u6d88\u8d39kafka",level:2}],d={toc:c},u="wrapper";function p(e){let{components:a,...t}=e;return(0,l.kt)(u,(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u5728clickhouse\u4e2d\u521b\u5efa\u8868"},"\u5728ClickHouse\u4e2d\u521b\u5efa\u8868"),(0,l.kt)("h3",{id:"\u76f8\u5173\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e"},"\u76f8\u5173\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e"),(0,l.kt)("p",null,"\u4e0e\u5927\u591a\u6570\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u4e00\u6837\uff0cClickHouse \u6309\u903b\u8f91\u5c06\u8868\u5206\u7ec4\u5230\u6570\u636e\u5e93\u4e2d\u3002\u4f7f\u7528CREATE DATABASE\u547d\u4ee4\u5728ClickHouse\u4e2d\u521b\u5efa\u65b0\u6570\u636e\u5e93\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE IF NOT EXISTS helloworld;\n``\n\n```sql\nh4 :) show databases;\n\nSHOW DATABASES\n\nQuery id: 44d7ceac-a2cc-4bf2-a293-bc7ec75ee93b\n\n\u250c\u2500name\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 INFORMATION_SCHEMA \u2502\n\u2502 default            \u2502\n\u2502 helloworld         \u2502\n\u2502 information_schema \u2502\n\u2502 system             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u5bf9\u5e94\u7684\u5b58\u50a8\u76ee\u5f55\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a\u6587\u4ef6\u5939(/var/lib/clickhouse/data) \u662f\u9ed8\u8ba4\u7684\u5b58\u50a8\u8def\u5f84\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd /var/lib/clickhouse/data\n\n[root data]# pwd\n/var/lib/clickhouse/data\n[root data]# ls\ndefault  helloworld  system\n[root data]# \n")),(0,l.kt)("p",null,"\u9ed8\u8ba4\u7684\u65e5\u5fd7\u5b58\u50a8\u5728/var/log/clickhouse-server/clickhouse-server.log\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u4fee\u6539sudo vim /etc/clickhouse-server/config.xml")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd /var/log/clickhouse-server/\n\n[root clickhouse-server]# cd /var/log/clickhouse-server/\n[root clickhouse-server]# ls\nclickhouse-server.err.log  clickhouse-server.log\n")),(0,l.kt)("p",null,"\u540c\u6837\uff0c\u4f7f\u7528CREATE TABLE\u6765\u5b9a\u4e49\u4e00\u4e2a\u65b0\u8868\u3002\uff08\u5982\u679c\u4e0d\u6307\u5b9a\u6570\u636e\u5e93\u540d\u79f0\uff0c\u5219\u8be5\u8868\u5c06\u5728 default\u6570\u636e\u5e93\u4e2d\u3002\uff09\u4ee5\u4e0b\u540d\u4e3a\u7684\u8868my_first_table\u5728\u6570\u636e\u5e93\u4e2dhelloworld\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE helloworld.my_first_table\n(\n    user_id UInt32,\n    message String,\n    timestamp DateTime,\n    metric Float32\n)\nENGINE = MergeTree()\nPRIMARY KEY (user_id, timestamp);\n")),(0,l.kt)("p",null,"\u5efa\u8868\u4ee5\u540e\u7684\u7ed3\u679c\u4e3a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"[root data]# ll helloworld/\ntotal 4\nlrwxrwxrwx 1 clickhouse clickhouse 67 Aug 10 09:39 my_first_table -> /var/lib/clickhouse/store/d4d/d4d2cd3e-a6ec-4f09-a013-d59da4cb1a75/\n")),(0,l.kt)("p",null,"\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0cmy_first_table\u662f\u4e00\u4e2aMergeTree\u5305\u542b\u56db\u5217\u7684\u8868\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"user_id: 32 \u4f4d\u65e0\u7b26\u53f7\u6574\u6570\u3002"),(0,l.kt)("li",{parentName:"ul"},"message\uff1a\u4e00\u79cdString\u6570\u636e\u7c7b\u578b\uff0c\u5b83",(0,l.kt)("strong",{parentName:"li"},"\u66ff\u6362\u5176\u4ed6\u6570\u636e\u5e93\u7cfb\u7edf\u4e2d\u7684VARCHAR\u3001BLOB\u3001CLOB\u7b49\u7c7b\u578b"),"\u3002"),(0,l.kt)("li",{parentName:"ul"},"timestamp: \u4e00\u4e2aDateTime\u503c\uff0c\u4ee3\u8868\u65f6\u95f4\u7684\u4e00\u4e2a\u77ac\u95f4\u3002"),(0,l.kt)("li",{parentName:"ul"},"metric\uff1a32\u4f4d\u6d6e\u70b9\u6570\u3002")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u8868\u5f15\u64ce\u786e\u5b9a\uff1a"),(0,l.kt)("ol",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ol"},"\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\u548c\u4f4d\u7f6e\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u652f\u6301\u54ea\u4e9b\u67e5\u8be2\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u6570\u636e\u662f\u5426\u88ab\u590d\u5236\u3002"))),(0,l.kt)("h3",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,l.kt)("p",null,"\u8be5MergeTree\u5f15\u64ce\u548c\u8be5\u5bb6\u65cf\u7684\u5176\u4ed6\u5f15\u64ce\uff08*MergeTree\uff09\u662f\u6700\u5f3a\u5927\u7684 ClickHouse \u8868\u5f15\u64ce\u3002\u8be5\u7cfb\u5217\u4e2d\u7684\u5f15\u64ceMergeTree\u8bbe\u8ba1\u7528\u4e8e\u5c06\u5927\u91cf\u6570\u636e\u63d2\u5165\u8868\u4e2d\u3002",(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e\u88ab\u5feb\u901f\u5730\u9010\u90e8\u5206\u5199\u5165\u8868\u4e2d\uff0c\u7136\u540e\u5e94\u7528\u89c4\u5219\u5728\u540e\u53f0\u5408\u5e76\u5404\u90e8\u5206"),"\u3002\u8fd9\u79cd\u65b9\u6cd5\u6bd4\u63d2\u5165\u65f6\u4e0d\u65ad\u91cd\u5199\u5b58\u50a8\u4e2d\u7684\u6570\u636e\u8981\u9ad8\u6548\u5f97\u591a\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4e3b\u8981\u7279\u70b9\uff1a")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5b58\u50a8\u6309\u4e3b\u952e\u6392\u5e8f\u7684\u6570\u636e\u3002\u8fd9\u5141\u8bb8\u60a8\u521b\u5efa\u4e00\u4e2a\u5c0f\u578b\u7a00\u758f\u7d22\u5f15\uff0c\u5e2e\u52a9\u66f4\u5feb\u5730\u67e5\u627e\u6570\u636e\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u6307\u5b9a\u4e86\u5206\u533a\u952e\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5206\u533a\u3002ClickHouse \u652f\u6301\u67d0\u4e9b\u5e26\u6709\u5206\u533a\u7684\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u6bd4\u5bf9\u76f8\u540c\u6570\u636e\u548c\u76f8\u540c\u7ed3\u679c\u7684\u5e38\u89c4\u64cd\u4f5c\u66f4\u6709\u6548\u3002",(0,l.kt)("strong",{parentName:"li"},"ClickHouse\u8fd8\u4f1a\u81ea\u52a8\u622a\u65ad\u67e5\u8be2\u4e2d\u6307\u5b9a\u5206\u533a\u952e\u7684\u5206\u533a\u6570\u636e"),"\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u6570\u636e\u91c7\u6837\u652f\u6301\u3002\u679c\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u5728\u8868\u4e2d\u8bbe\u7f6e\u6570\u636e\u91c7\u6837\u65b9\u6cd5\u3002")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5efa\u8868\u8bed\u53e5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]\n(\n    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS|EPHEMERAL expr1] [TTL expr1] [CODEC(codec1)] [[NOT] NULL|PRIMARY KEY],\n    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS|EPHEMERAL expr2] [TTL expr2] [CODEC(codec2)] [[NOT] NULL|PRIMARY KEY],\n    ...\n    INDEX index_name1 expr1 TYPE type1(...) [GRANULARITY value1],\n    INDEX index_name2 expr2 TYPE type2(...) [GRANULARITY value2],\n    ...\n    PROJECTION projection_name_1 (SELECT <COLUMN LIST EXPR> [GROUP BY] [ORDER BY]),\n    PROJECTION projection_name_2 (SELECT <COLUMN LIST EXPR> [GROUP BY] [ORDER BY])\n) ENGINE = MergeTree()\nORDER BY expr\n[PARTITION BY expr]\n[PRIMARY KEY expr]\n[SAMPLE BY expr]\n[TTL expr\n    [DELETE|TO DISK 'xxx'|TO VOLUME 'xxx' [, ...] ]\n    [WHERE conditions]\n    [GROUP BY key_expr [SET v1 = aggr_func(v1) [, v2 = aggr_func(v2) ...]] ] ]\n[SETTINGS name=value, ...]\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"ORDER BY\uff1a"),"\u5217\u540d\u6216\u4efb\u610f\u8868\u8fbe\u5f0f\u7684\u5143\u7ec4\u3002\u793a\u4f8b\uff1aORDER BY (CounterID, EventDate)\u3002\u5982\u679c\u5b50\u53e5\u672a\u663e\u5f0f\u5b9a\u4e49\u4e3b\u952e\uff0cClickHouse \u4f1a\u4f7f\u7528\u6392\u5e8f\u952e\u4f5c\u4e3a\u4e3b\u952ePRIMARY KEY\u3002ORDER BY tuple()\u5982\u679c\u4e0d\u9700\u8981\u6392\u5e8f\uff0c\u8bf7\u4f7f\u7528\u8bed\u6cd5\u3002\u8bf7\u53c2\u9605\u9009\u62e9\u4e3b\u952e\u3002\u4e0b\u9762\u5206\u522b\u5217\u4e3e\u4e86\u4f7f\u7528ORDER BY \u548c\u4e0d\u4f7f\u7528\u7684\u60c5\u51b5\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE helloworld.my_oneo_table\n(\n    user_id UInt32,\n    message String,\n    timestamp DateTime,\n    metric Float32\n)\nENGINE = MergeTree()\nORDER BY (user_id, timestamp)\nPRIMARY KEY (user_id);\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE helloworld.my_tow_table\n(\n    user_id UInt32,\n    message String,\n    timestamp DateTime,\n    metric Float32\n)\nENGINE = MergeTree()\nPRIMARY KEY (user_id, timestamp);\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"PARTITION BY\uff1a")," PARTITION BY\u2014\u5206\u533a\u952e\u3002\u53ef\u9009\u4fee\u7684\u3002\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u60a8\u4e0d\u9700\u8981\u5206\u533a\u952e\uff0c\u5982\u679c\u786e\u5b9e\u9700\u8981\u5206\u533a\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u6bd4\u6309\u6708\u66f4\u7ec6\u7c92\u5ea6\u7684\u5206\u533a\u952e\u3002",(0,l.kt)("strong",{parentName:"li"},"\u5206\u533a\u4e0d\u4f1a\u52a0\u901f\u67e5\u8be2\uff08\u4e0e ORDER BY \u8868\u8fbe\u5f0f\u76f8\u53cd\uff09"),'\u3002\u6c38\u8fdc\u4e0d\u5e94\u8be5\u4f7f\u7528\u592a\u7ec6\u7c92\u5ea6\u7684\u5206\u533a\u3002\u4e0d\u8981\u6309\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26\u6216\u540d\u79f0\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u533a\uff08\u800c\u662f\u5c06\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26\u6216\u540d\u79f0\u4f5c\u4e3a ORDER BY \u8868\u8fbe\u5f0f\u4e2d\u7684\u7b2c\u4e00\u5217\uff09\u3002\u5bf9\u4e8e\u6309\u6708\u5206\u533a\uff0c\u8bf7\u4f7f\u7528\u8868\u8fbe\u5f0ftoYYYYMM(date_column)\uff0c\u5176\u4e2ddate_column\u662f\u65e5\u671f\u7c7b\u578b\u4e3aDate\u7684\u5217\u3002\u8fd9\u91cc\u7684\u5206\u533a\u540d\u79f0\u6709\u683c\u5f0f"YYYYMM"\u3002')),(0,l.kt)("p",null,"\u4e0a\u9762\u8bf4\u5230\u5206\u533a\u4e0d\u4f1a\u52a0\u901f\u67e5\u8be2\uff0c\u662f\u56e0\u4e3aClickHouse\u7684\u5b58\u50a8\u5f15\u64ce\uff08\u4e3b\u8981\u662fMergeTree\u5f15\u64ce\uff09\u5df2\u7ecf\u9ad8\u5ea6\u4f18\u5316\uff0c\u80fd\u591f\u5728\u5927\u89c4\u6a21\u6570\u636e\u4e0a\u8fdb\u884c\u5feb\u901f\u7684\u5217\u5f0f\u5b58\u50a8\u548c\u67e5\u8be2\uff0c\u800c\u5206\u533a\u5e76\u4e0d\u662f\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u7684\u4e3b\u8981\u624b\u6bb5\u3002"),(0,l.kt)("p",null,"\u7136\u800c\uff0c\u5206\u533a\u4ecd\u7136\u6709\u5176\u4f18\u52bf\uff0c\u5c24\u5176\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e\u7ba1\u7406\u548c\u7ef4\u62a4\uff1a")," \u5206\u533a\u53ef\u4ee5\u5e2e\u52a9\u4f60\u66f4\u6709\u6548\u5730\u7ba1\u7406\u548c\u7ef4\u62a4\u5927\u91cf\u6570\u636e\u3002\u4f8b\u5982\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u5220\u9664\u65e7\u6570\u636e\u3001\u8fdb\u884c\u6570\u636e\u5907\u4efd\u548c\u6062\u590d\u7b49\u64cd\u4f5c\u53ef\u4ee5\u5728\u5206\u533a\u7ea7\u522b\u66f4\u52a0\u7075\u6d3b\u548c\u9ad8\u6548\u5730\u6267\u884c"),"\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e\u52a0\u8f7d\u548c\u5220\u9664\uff1a")," \u5f53\u9700\u8981\u5927\u91cf\u6570\u636e\u52a0\u8f7d\u6216\u5220\u9664\u65f6\uff0c\u5206\u533a\u53ef\u4ee5\u964d\u4f4e\u64cd\u4f5c\u7684\u590d\u6742\u6027\u3002",(0,l.kt)("strong",{parentName:"p"},"\u4f60\u53ef\u4ee5\u9488\u5bf9\u7279\u5b9a\u5206\u533a\u8fdb\u884c\u52a0\u8f7d\u6216\u5220\u9664\uff0c\u800c\u4e0d\u9700\u8981\u5904\u7406\u6574\u4e2a\u8868"),"\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e\u4fdd\u7559\u7b56\u7565\uff1a")," \u5206\u533a\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u6570\u636e\u4fdd\u7559\u7b56\u7565\uff0c\u6bd4\u5982\u6839\u636e\u65e5\u671f\u6216\u5176\u4ed6\u6807\u5fd7\u81ea\u52a8\u5220\u9664\u6216\u5f52\u6863\u65e7\u6570\u636e\u3002"))),(0,l.kt)("p",null,"\u4e0b\u9762\u662f\u6309\u6307\u5b9a\u65f6\u95f4\u5b57\u6bb5\u6309\u65f6\u95f4\u5206\u533a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE helloworld.my_three_table\n(\n    user_id UInt32,\n    message String,\n    timestamp DateTime,\n    metric Float32\n)\nENGINE = MergeTree()\nPARTITION BY toYYYYMM(timestamp)\nPRIMARY KEY (user_id, timestamp);\n")),(0,l.kt)("p",null,"\u4e0b\u9762\u4e3e\u4e00\u4e2a\u5b9e\u9645\u60c5\u51b5\u5206\u5e93\u5206\u8868\u5408\u8868\u7684\u60c5\u51b5,\u5047\u8bbe\u4f60\u6709\u591a\u4e2aMySQL\u8868\uff0c\u6bcf\u4e2a\u8868\u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4f60\u5e0c\u671b\u6bcf\u4e2aMySQL\u8868\u7684\u6570\u636e\u90fd\u5199\u5165ClickHouse\u7684\u5bf9\u5e94\u5206\u533a\u4e2d\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efaClickHouse\u5206\u533a\u8868\nCREATE TABLE partitioned_data\n(\n    table_name String,\n    data_id Int64,\n    data_value String\n) ENGINE = MergeTree()\nPARTITION BY table_name\nORDER BY (table_name, data_id);\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u63d2\u5165\u6570\u636e\u5230ClickHouse\u5206\u533a\u8868\uff0c\u5206\u522b\u63d2\u5165\u5230\u4e0d\u540c\u7684\u5206\u533a\nINSERT INTO partitioned_data (table_name, data_id, data_value)\nVALUES ('mysql_table1', 1, 'Data for MySQL Table 1');\n\nINSERT INTO partitioned_data (table_name, data_id, data_value)\nVALUES ('mysql_table2', 1, 'Data for MySQL Table 2');\n\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"h4 :) select * from partitioned_data;\n\nSELECT *\nFROM partitioned_data\n\nQuery id: d7138b7f-8d22-4501-a699-9273307745bc\n\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table2 \u2502       1 \u2502 Data for MySQL Table 2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table1 \u2502       1 \u2502 Data for MySQL Table 1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ufffd\ufffd\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u63d2\u5165\u6570\u636e\u5230ClickHouse\u5206\u533a\u8868\uff0c\u5206\u522b\u63d2\u5165\u5230\u4e0d\u540c\u7684\u5206\u533a\nINSERT INTO partitioned_data (table_name, data_id, data_value)\nVALUES ('mysql_table1', 2, 'Data for MySQL Table 1');\n\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"h4 :) select * from partitioned_data;\n\nSELECT *\nFROM partitioned_data\n\nQuery id: 449345e4-f0e9-4845-8243-4c255479920e\n\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table1 \u2502       1 \u2502 Data for MySQL Table 1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table2 \u2502       1 \u2502 Data for MySQL Table 2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ufffd\ufffd\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table1 \u2502       2 \u2502 Data for MySQL Table 1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.001 sec. \n")),(0,l.kt)("p",null,"\u4e3a\u4ec0\u4e48\u4f1a\u67093\u4e2a\u683c\u5b50\u5462\uff1f\u5e26\u7740\u8fd9\u4e2a\u7591\u95ee\u6211\u4eec\u770b\u4e0b\u5b58\u50a8\u7684\u5730\u65b9\u3002\u5982\u4e0b\u67093\u4e2a\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"[root@h4 partitioned_data]# pwd\n/var/lib/clickhouse/data/helloworld/partitioned_data\n[root@h4 partitioned_data]# ll\ntotal 20\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:26 50e99f74d0667129b0094c8a85b72127_1_1_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:27 50e99f74d0667129b0094c8a85b72127_3_3_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:26 cbe4b6754726233b82d55fc111a8787c_2_2_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:25 detached\n-rw-r----- 1 clickhouse clickhouse    1 Aug 10 10:25 format_version.txt\n")),(0,l.kt)("p",null,"\u624b\u52a8\u89e6\u53d1\u5408\u5e76"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"-- \u624b\u52a8\u89e6\u53d1\u6570\u636e\u5408\u5e76\u64cd\u4f5c\nOPTIMIZE TABLE partitioned_data;\nselect * from partitioned_data;\n")),(0,l.kt)("p",null,"\u6267\u884c\u7ed3\u679c\u4e3a\u5982\u4e0b,\u53ef\u4ee5\u770b\u5230\u76f8\u540c\u5206\u533a\u7684\u6570\u636e\u5728\u4e00\u5757\u663e\u793a\u4e86\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"h4 :) OPTIMIZE TABLE partitioned_data;\n\nOPTIMIZE TABLE partitioned_data\n\nQuery id: bff04a3f-85a6-496b-9f82-d1417bfab8d2\n\nOk.\n\n0 rows in set. Elapsed: 0.002 sec. \n\nh4 :) select * from partitioned_data;\n\nSELECT *\nFROM partitioned_data\n\nQuery id: ebd9996d-d167-42b4-8a31-7faabfdc09ef\n\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table2 \u2502       1 \u2502 Data for MySQL Table 2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table1 \u2502       1 \u2502 Data for MySQL Table 1 \u2502\n\u2502 mysql_table1 \u2502       2 \u2502 Data for MySQL Table 1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.002 sec. \n")),(0,l.kt)("p",null,"\u7136\u540e\u770b\u4e0b\u6570\u636e\u5177\u4f53\u5b58\u50a8\u7684\u60c5\u51b5\u3002\u591a\u4e86\u4e00\u4e2a1_3_1\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd /var/lib/clickhouse/data/helloworld/partitioned_data\n\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:26 50e99f74d0667129b0094c8a85b72127_1_1_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:27 50e99f74d0667129b0094c8a85b72127_3_3_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:26 cbe4b6754726233b82d55fc111a8787c_2_2_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:25 detached\n-rw-r----- 1 clickhouse clickhouse    1 Aug 10 10:25 format_version.txt\n[root@h4 partitioned_data]# cd /var/lib/clickhouse/data/helloworld/partitioned_data\n[root@h4 partitioned_data]# ll\ntotal 24\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:26 50e99f74d0667129b0094c8a85b72127_1_1_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:50 50e99f74d0667129b0094c8a85b72127_1_3_1\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:27 50e99f74d0667129b0094c8a85b72127_3_3_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:26 cbe4b6754726233b82d55fc111a8787c_2_2_0\ndrwxr-x--- 2 clickhouse clickhouse 4096 Aug 10 10:25 detached\n-rw-r----- 1 clickhouse clickhouse    1 Aug 10 10:25 format_version.txt\n")),(0,l.kt)("p",null,"\u5728ClickHouse\u4e2d\uff0c\u6570\u636e\u5b58\u50a8\u7684\u6587\u4ef6\u5939\u540d\u79f0\u4e2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"3_3_0")," \u540e\u7f00\u8868\u793a\u5206\u533a\u7684\u7248\u672c\u53f7\u3002ClickHouse\u652f\u6301\u591a\u4e2a\u5206\u533a\u7248\u672c\uff0c\u8fd9\u6837\u53ef\u4ee5\u5b9e\u73b0\u5206\u533a\u7684\u589e\u91cf\u66f4\u65b0\u548c\u5220\u9664\uff0c\u800c\u4e0d\u662f\u5b8c\u5168\u91cd\u5199\u6574\u4e2a\u5206\u533a\u3002"),(0,l.kt)("p",null,"\u5177\u4f53\u6765\u8bf4\uff0c\u5206\u533a\u7248\u672c\u5305\u62ec\u4e09\u4e2a\u90e8\u5206\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7b2c\u4e00\u4e2a\u6570\u5b57\uff1a\u8868\u793a\u589e\u91cf\u63d2\u5165\u7684\u6b21\u6570\u3002\u6bcf\u6b21\u6267\u884c\u63d2\u5165\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u6570\u5b57\u4f1a\u589e\u52a0\uff0c\u6307\u793a\u5206\u533a\u7684\u7b2c\u51e0\u6b21\u63d2\u5165\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7b2c\u4e8c\u4e2a\u6570\u5b57\uff1a\u8868\u793a\u5220\u9664\u64cd\u4f5c\u7684\u6b21\u6570\u3002ClickHouse\u652f\u6301\u5408\u5e76\u5220\u9664\uff08MergeTree\u8868\u5f15\u64ce\u7684\u7279\u6027\uff09\uff0c\u8fd9\u4e2a\u6570\u5b57\u4f1a\u589e\u52a0\uff0c\u6307\u793a\u5206\u533a\u7684\u7b2c\u51e0\u6b21\u5220\u9664\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7b2c\u4e09\u4e2a\u6570\u5b57\uff1a\u8868\u793a\u5206\u533a\u5408\u5e76\u7684\u6b21\u6570\u3002\u5f53\u5206\u533a\u8fbe\u5230\u4e00\u5b9a\u6570\u91cf\u540e\uff0cClickHouse\u4f1a\u81ea\u52a8\u5408\u5e76\u5206\u533a\uff0c\u4f18\u5316\u67e5\u8be2\u6027\u80fd\u3002\u8fd9\u4e2a\u6570\u5b57\u6307\u793a\u5206\u533a\u7ecf\u5386\u4e86\u591a\u5c11\u6b21\u5408\u5e76\u3002")),(0,l.kt)("p",null,"\u6240\u4ee5\u5728\u4f60\u63d0\u4f9b\u7684\u793a\u4f8b\u4e2d\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"3_3_0")," \u8868\u793a\u8fd9\u4e2a\u5206\u533a\u7684\u589e\u91cf\u63d2\u5165\u6b21\u6570\u4e3a 3\uff0c\u5220\u9664\u6b21\u6570\u4e3a 3\uff0c\u5408\u5e76\u6b21\u6570\u4e3a 0\u3002"),(0,l.kt)("p",null,"\u8fd9\u79cd\u5206\u533a\u7248\u672c\u7684\u8bbe\u8ba1\u5141\u8bb8ClickHouse\u5728\u8fdb\u884c\u6570\u636e\u63d2\u5165\u3001\u5220\u9664\u548c\u5408\u5e76\u65f6\u80fd\u591f\u66f4\u52a0\u9ad8\u6548\u5730\u7ba1\u7406\u6570\u636e\uff0c\u5e76\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u67e5\u8be2\u6027\u80fd\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u63d2\u5165\u6570\u636e\u5230ClickHouse\u5206\u533a\u8868\uff0c\u5206\u522b\u63d2\u5165\u5230\u4e0d\u540c\u7684\u5206\u533a\nINSERT INTO partitioned_data (table_name, data_id, data_value)\nVALUES ('mysql_table1', 3, 'Data for MySQL Table 1');\n\nINSERT INTO partitioned_data (table_name, data_id, data_value)\nVALUES ('mysql_table2', 3, 'Data for MySQL Table 2');\n\nh4 :) OPTIMIZE TABLE partitioned_data;\n\nOPTIMIZE TABLE partitioned_data\n\nQuery id: 8316289c-51da-4ffe-9213-1bde8a1b6423\n\nOk.\n\n0 rows in set. Elapsed: 0.002 sec. \n\nh4 :) select * from partitioned_data;\n\nSELECT *\nFROM partitioned_data\n\nQuery id: 2510feb8-5e1d-4318-a8ce-38b4f83f7e6e\n\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table1 \u2502       1 \u2502 Data for MySQL Table 1 \u2502\n\u2502 mysql_table1 \u2502       2 \u2502 Data for MySQL Table 1 \u2502\n\u2502 mysql_table1 \u2502       3 \u2502 Data for MySQL Table 1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table2 \u2502       1 \u2502 Data for MySQL Table 2 \u2502\n\u2502 mysql_table2 \u2502       3 \u2502 Data for MySQL Table 2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u5355\u5206\u533a\u7684\u770b\u4e0b\u6548\u679c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efaClickHouse\u5206\u533a\u8868\nCREATE TABLE partitioned_data2\n(\n    table_name String,\n    data_id Int64,\n    data_value String\n) ENGINE = MergeTree()\nPRIMARY KEY (data_id);\n\n-- \u63d2\u5165\u6570\u636e\u5230ClickHouse\u5206\u533a\u8868\uff0c\u5206\u522b\u63d2\u5165\u5230\u4e0d\u540c\u7684\u5206\u533a\nINSERT INTO partitioned_data2 (table_name, data_id, data_value)\nVALUES ('mysql_table1', 3, 'Data for MySQL Table 1');\n\nINSERT INTO partitioned_data2 (table_name, data_id, data_value)\nVALUES ('mysql_table2', 3, 'Data for MySQL Table 2');\n\nINSERT INTO partitioned_data2 (table_name, data_id, data_value)\nVALUES ('mysql_table2', 3, 'Data for MySQL Table 2');\n\nselect * from partitioned_data2;\n\nOPTIMIZE TABLE partitioned_data2;\n\nh4 :) select * from partitioned_data2;\n\nSELECT *\nFROM partitioned_data2\n\nQuery id: 3573b44f-8c66-420b-ab0d-54ad48c05a10\n\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table1 \u2502       3 \u2502 Data for MySQL Table 1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table2 \u2502       3 \u2502 Data for MySQL Table 2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ufffd\ufffd\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table2 \u2502       3 \u2502 Data for MySQL Table 2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.002 sec. \n\nh4 :) OPTIMIZE TABLE partitioned_data2;\n\nOPTIMIZE TABLE partitioned_data2\n\nQuery id: 9e1d4f3c-4e89-4bc1-9216-00b2a538e3ec\n\nOk.\n\n0 rows in set. Elapsed: 0.002 sec. \n\nh4 :) select * from partitioned_data2;\n\nSELECT *\nFROM partitioned_data2\n\nQuery id: 91fe5291-3343-41ff-9b31-9e0999b74d7e\n\n\u250c\u2500table_name\u2500\u2500\u2500\u252c\u2500data_id\u2500\u252c\u2500data_value\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 mysql_table1 \u2502       3 \u2502 Data for MySQL Table 1 \u2502\n\u2502 mysql_table2 \u2502       3 \u2502 Data for MySQL Table 2 \u2502\n\u2502 mysql_table2 \u2502       3 \u2502 Data for MySQL Table 2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.001 sec. \n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"PRIMARY KEY :")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"ClickHouse \u4e2d\u7684\u4e3b\u952e\u5bf9\u4e8e\u8868\u4e2d\u7684\u6bcf\u4e00\u884c\u6765\u8bf4",(0,l.kt)("strong",{parentName:"li"},"\u4e0d\u662f\u552f\u4e00\u7684"),"\u3002"),(0,l.kt)("li",{parentName:"ul"},"ClickHouse \u8868\u7684\u4e3b\u952e",(0,l.kt)("strong",{parentName:"li"},"\u51b3\u5b9a\u4e86\u6570\u636e\u5199\u5165\u78c1\u76d8\u65f6\u7684\u6392\u5e8f\u65b9\u5f0f"),"\u3002",(0,l.kt)("strong",{parentName:"li"},"\u6bcf 8,192 \u884c\u6216 10MB \u6570\u636e\uff08\u79f0\u4e3a\u7d22\u5f15\u7c92\u5ea6\uff09\u5728\u4e3b\u952e\u7d22\u5f15\u6587\u4ef6\u4e2d\u521b\u5efa\u4e00\u4e2a\u6761\u76ee"),"\u3002\u8fd9\u79cd\u7c92\u5ea6\u6982\u5ff5\u521b\u5efa\u4e86\u4e00\u4e2a\u53ef\u4ee5\u8f7b\u677e\u653e\u5165\u5185\u5b58\u7684\u7a00\u758f\u7d22\u5f15SELECT\uff0c\u5e76\u4e14\u9897\u7c92\u8868\u793a\u67e5\u8be2\u671f\u95f4\u5904\u7406\u7684\u6700\u5c0f\u5217\u6570\u636e\u91cf\u7684\u6761\u5e26\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u4e3b\u952e\u53ef\u4ee5\u4f7f\u7528PRIMARY KEY\u53c2\u6570\u5b9a\u4e49\u3002\u5982\u679c\u5b9a\u4e49\u8868\u65f6",(0,l.kt)("strong",{parentName:"li"},"\u672aPRIMARY KEY\u6307\u5b9a\uff0c\u5219\u952e\u5c06\u6210\u4e3aORDER BY\u5b50\u53e5\u4e2d\u6307\u5b9a\u7684\u5143\u7ec4"),"\u3002\u5982\u679c\u60a8\u540c\u65f6\u6307\u5b9a PRIMARY KEY \u548c ORDER BY\uff0c\u5219",(0,l.kt)("strong",{parentName:"li"},"\u4e3b\u952e\u5fc5\u987b\u662f\u6392\u5e8f\u987a\u5e8f\u7684\u5b50\u96c6"),"\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u4e3b\u952e\u4e5f\u662f\u6392\u5e8f\u952e\uff0c\u5b83\u662f \u7684\u5143\u7ec4(user_id, timestamp)\u3002\u56e0\u6b64\uff0c",(0,l.kt)("strong",{parentName:"li"},"\u6bcf\u4e2a\u5217\u6587\u4ef6\u4e2d\u5b58\u50a8\u7684\u6570\u636e\u5c06\u6309user_id\uff0c\u7136\u540e\u6392\u5e8ftimestamp"),"\u3002")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"SAMPLE BY:")," \u2014 \u91c7\u6837\u8868\u8fbe\u5f0f\u3002\u53ef\u9009\u4fee\u7684\u3002\u5982\u679c\u4f7f\u7528\u91c7\u6837\u8868\u8fbe\u5f0f\uff0c\u4e3b\u952e\u5fc5\u987b\u5305\u542b\u5b83\u3002\u91c7\u6837\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u5fc5\u987b\u662f\u65e0\u7b26\u53f7\u6574\u6570\u3002\u793a\u4f8b\uff1aSAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))\u3002")),(0,l.kt)("p",null,"\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u5305\u542b\u5927\u91cf\u7528\u6237\u884c\u4e3a\u6570\u636e\u7684\u8868\uff0c\u4f46\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ea\u9700\u8981",(0,l.kt)("strong",{parentName:"p"},"\u5bf9\u6570\u636e\u8fdb\u884c\u91c7\u6837\u5206\u6790\u800c\u4e0d\u9700\u8981\u5904\u7406\u5168\u90e8\u6570\u636e"),"\u3002\u5f53\u4f60\u67e5\u8be2\u8fd9\u4e2a\u8868\u65f6\uff0cClickHouse\u4f1a\u81ea\u52a8\u5e94\u7528\u91c7\u6837\uff0c\u5e76",(0,l.kt)("strong",{parentName:"p"},"\u53ea\u8fd4\u56de\u91c7\u6837\u540e\u7684\u6570\u636e\u5b50\u96c6"),"\u3002\u8fd9\u53ef\u4ee5\u52a0\u5feb\u67e5\u8be2\u901f\u5ea6\uff0c\u7279\u522b\u662f\u5728\u5904\u7406\u5927\u578b\u6570\u636e\u96c6\u65f6\u3002\u8bf7\u6ce8\u610f\uff0c\u91c7\u6837\u662f\u4e00\u79cd\u8fd1\u4f3c\u7684\u6280\u672f\uff0c\u53ef\u4ee5\u5728\u4fdd\u6301\u67e5\u8be2\u901f\u5ea6\u7684\u540c\u65f6\u51cf\u5c11\u6570\u636e\u91cf\u3002\u6839\u636e\u9700\u6c42\u548c\u6570\u636e\u5206\u5e03\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u91c7\u6837\u7b56\u7565\uff0c\u5982\u6309\u6bd4\u4f8b\u91c7\u6837\u3001\u6309\u884c\u6570\u91c7\u6837\u7b49\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efa\u4e00\u4e2a\u5e26\u6709SAMPLE BY\u7684\u8868\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u91c7\u6837\nCREATE TABLE sampled_user_actions (\n    user_id UInt32,\n    action_type String,\n    action_time DateTime\n) ENGINE = MergeTree()\nORDER BY (user_id, action_time)\nSAMPLE BY user_id;\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"TTL\uff1a"),"  \u6307\u5b9a\u884c\u5b58\u50a8\u6301\u7eed\u65f6\u95f4\u5e76\u5b9a\u4e49\u78c1\u76d8\u548c\u5377\u4e4b\u95f4\u81ea\u52a8\u90e8\u4ef6\u5220\u9664\u903b\u8f91\u7684\u89c4\u5219\u5217\u8868\u3002")),(0,l.kt)("p",null,"\u5047\u8bbe\u4f60\u60f3\u8981\u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u65e5\u5fd7\u6570\u636e\u7684\u8868\uff0c\u4f46\u662f\u4f60\u53ea\u60f3\u4fdd\u7559\u6700\u8fd130\u5929\u7684\u6570\u636e\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528TTL\u6765\u81ea\u52a8\u5220\u9664\u8d85\u8fc730\u5929\u7684\u6570\u636e\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efa\u4e00\u4e2a\u5e26\u6709TTL\u7684\u8868\uff0c\u4fdd\u7559\u6700\u8fd130\u5929\u7684\u6570\u636e\nCREATE TABLE log_data (\n    log_date Date DEFAULT toDate(now()),\n    message String\n) ENGINE = MergeTree()\nORDER BY log_date\nTTL log_date + INTERVAL 30 DAY;\n\n")),(0,l.kt)("p",null,"\u89c4\u5219\u7684\u7c7b\u578bDELETE|TO DISK 'xxx'|TO VOLUME 'xxx'|GROUP BY\u6307\u5b9a\u5982\u679c\u6ee1\u8db3\u8868\u8fbe\u5f0f\uff08\u8fbe\u5230\u5f53\u524d\u65f6\u95f4\uff09\u5219\u8981\u5bf9\u8be5\u90e8\u5206\u6267\u884c\u7684\u64cd\u4f5c\uff1a\u5220\u9664\u8fc7\u671f\u884c\u3001\u5c06\u90e8\u5206\u79fb\u52a8\uff08\u5982\u679c\u90e8\u5206\u4e2d\u7684\u6240\u6709\u884c\u90fd\u6ee1\u8db3\u8868\u8fbe\u5f0f\uff09\u5230\u6307\u5b9a\u78c1\u76d8 ( )TO DISK 'xxx'\u6216\u5230\u5377 ( TO VOLUME 'xxx')\uff0c\u6216\u805a\u5408\u8fc7\u671f\u884c\u4e2d\u7684\u503c\u3002\u89c4\u5219\u7684\u9ed8",(0,l.kt)("strong",{parentName:"p"},"\u8ba4\u7c7b\u578b\u662f\u5220\u9664 ( DELETE)"),"\u3002\u53ef\u4ee5\u6307\u5b9a\u591a\u6761\u89c4\u5219\u7684\u5217\u8868\uff0c\u4f46\u4e0d\u5f97\u8d85\u8fc7\u4e00\u6761DELETE\u89c4\u5219\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"SETTINGS\uff1a")," \u63a7\u5236\u884c\u4e3a\u7684\u9644\u52a0\u53c2\u6570MergeTree\u3002")),(0,l.kt)("p",null,"\u4f8b\u5b50:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efa\u5e26\u6709\u591a\u4e2a\u8868\u7ea7\u522b\u8bbe\u7f6e\u7684\u8868\nCREATE TABLE settings_example\n(\n    id Int64,\n    name String\n) ENGINE = MergeTree()\nORDER BY id\nSETTINGS write_final_mark = 2, index_granularity = 8192;\n")),(0,l.kt)("h2",{id:"clickhouse\u6d88\u8d39kafka"},"ClickHouse\u6d88\u8d39Kafka"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/integrations/kafka"},"https://clickhouse.com/docs/en/integrations/kafka"))),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u8fd9\u91cc\u6f14\u793a\u7684\u662fjson\u6570\u636e\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE \u5e93\u540d.kafka \u5bf9\u5e94\u8868\u540d\n(\n    `msg` String\n)\n    ENGINE = Kafka\n        SETTINGS kafka_broker_list =\n                'xxxx:\u7aef\u53e3', kafka_topic_list = '\u4e3b\u9898', kafka_group_name = '\u6d88\u8d39\u8005\u7ec4', kafka_format = 'JSONAsString',kafka_num_consumers = 3;\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u521b\u5efa\u7269\u5316\u89c6\u56fe\u7684\u5b9e\u4f53\u8868\uff0c\u5982\u679c\u6ca1\u6709\u5b83\uff0c\u90a3\u4e48\u521b\u5efa\u51fa\u6765\u7684\u7269\u5316\u89c6\u56fe\u7684\u5b9e\u4f53\u8868\u662f\u4e00\u5f20\u9690\u85cf\u7684\u8868\uff0c\u81ea\u5df1\u521b\u5efa\u5bf9\u5e94\u7684\u8868\u6bd4\u8f83\u597d\u7ba1\u7406\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE default.jielong_team_mp_message\n(\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3',\n    `\u5b57\u6bb5` String COMMENT '\u6ce8\u89e3'\n)\n    ENGINE = MergeTree\n        PARTITION BY DATE(\u5b57\u6bb5)\n        ORDER BY (\u5b57\u6bb5, \u5b57\u6bb5)\n        SETTINGS index_granularity = 8192, storage_policy = '\u5206\u533a\u7b56\u7565';\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u521b\u5efa\u7269\u5316\u89c6\u56fe\uff0c\u5e76\u6307\u5b9a\u5b58\u50a8\u7684\u5b9e\u4f53\u8868\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE MATERIALIZED VIEW \u5e93\u540d.\u8868\u540d\n            TO default.\u5bf9\u5e94\u7b2c\u4e8c\u6b65\u7684\u5b9e\u4f53\u8868\n            (\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64,\n             `\u5b57\u6bb5` UInt64\n                )\nAS\nSELECT JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')                 AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')               AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')     AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')            AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')                   AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')       AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')       AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')        AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64') AS \u5b57\u6bb5,\n       JSONExtract(msg, '\u5b57\u6bb5', 'UInt64')             AS \u5b57\u6bb5\nFROM \u5e93\u540d.\u5bf9\u5e94kafka\u8868\u540d;\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u76f4\u63a5\u5220\u9664\u5c31\u884c\uff0c\u8fd9\u91cc\u7684\u5220\u9664\u8868\u4e0d\u4f1a\u5f71\u54cd\u5b9e\u9645\u7684\u4e3b\u9898\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"drop table \n")))}p.isMDXComponent=!0}}]);